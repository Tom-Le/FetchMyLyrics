#!/bin/bash -e

# This build script is meant to be used in conjunction with tcprelay.py,
# and with the assumption that you have your public key stored in your 
# iDevice (otherwise it would ask for your password every time and that would
# be a pain in the ass.

# Also, configure your .ssh/config
# Example: (in .ssh/config)
# Hosts ipod
#      User     root
#      Port     2222           or whatever you used while running tcprelay.py
#      HostName localhost

export THEOS="./theos"

make

echo "Making bundle..."
mkdir -p obj/FML.app
cp obj/FML obj/FML.app/
cp Resources/* obj/FML.app/

echo "Transferring files..."
scp -q obj/FetchMyLyrics.dylib         ipod://Library/MobileSubstrate/DynamicLibraries/
scp -q FetchMyLyrics.plist             ipod://Library/MobileSubstrate/DynamicLibraries/
scp -q Preferences/FetchMyLyrics.plist ipod://Library/PreferenceLoader/Preferences/ 
# scp -q -r obj/FML.app                  ipod://Applications/

echo "Respringing..."
ssh ipod killall SpringBoard
