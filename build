#!/bin/bash -e

# This build script is meant to be used in conjunction with tcprelay.py,
# and with the assumption that you have your public key stored in your 
# iDevice (otherwise it would ask for your password every time and that would
# be a pain in the ass.

# Can supply 1 argument for port number; default is 2222.

if [ -n "$1" ]
then
    FML_PORTNO="$1"
else
    FML_PORTNO="2222"
fi

make

echo "Transferring files..."
scp -P $FML_PORTNO obj/FetchMyLyrics.dylib root@localhost:/Library/MobileSubstrate/DynamicLibraries/
scp -P $FML_PORTNO FetchMyLyrics.plist root@localhost:/Library/MobileSubstrate/DynamicLibraries/
scp -P $FML_PORTNO Preferences/FetchMyLyrics.plist root@localhost:/Library/PreferenceLoader/Preferences/

echo "Respringing..."
ssh -p $FML_PORTNO -l root localhost killall SpringBoard
